# 목표 워크플로우 학습 정리

## 전체 워크플로우 개요

```
[매일 아침 7시 자동 실행]
        ↓
1. 화제 종목 수집
   - Yahoo Finance Screener (거래량/상승률 상위)
   - 또는 WSB 멘션 집계 서비스 (ApeWisdom 등)
        ↓
2. TOP 1 종목 선정
        ↓
3. 해당 종목 정보 수집
   - 회사 기본 정보 (yahooquery)
   - 관련 뉴스 요약 (Exa API)
   - 왜 화제인지 분석
        ↓
4. 브리핑 콘텐츠 생성
   - 이미지: Gemini API
   - 텍스트: 간단 리포트
        ↓
5. 자동 발송 (이메일/슬랙)
```

---

## 현재 구현 상태 분석

### ✅ 구현 완료된 부분

#### 1. 화제 종목 수집
- **파일**: `backend/get_trending_stocks.py`
- **기능**: 
  - Yahoo Finance Screener를 통한 거래량/상승률 상위 종목 수집
  - `get_trending_stocks()`: 여러 스크리너 타입에서 종목 수집
  - `get_top_trending_stock()`: TOP 1 종목 선정
- **상태**: ✅ 완료

#### 2. TOP 1 종목 선정
- **파일**: `backend/get_trending_stocks.py`
- **기능**: 
  - `most_actives` (거래량 상위) 우선 사용
  - 없으면 `day_gainers` (상승률 상위) 사용
- **상태**: ✅ 완료 (단순화된 로직)

#### 3. 종목 정보 수집
- **파일**: `backend/get_trending_stocks.py`
- **기능**: 
  - `format_stock_data()`: Yahoo Finance 데이터를 표준 형식으로 변환
  - 종목명, 현재가, 변동률, 거래량, 시가총액 등 수집
- **상태**: ✅ 완료

#### 4. 뉴스 수집 및 요약
- **파일**: `backend/exa_news.py`
- **기능**: 
  - `search_stock_news()`: Exa API를 통한 종목별 뉴스 검색
  - `get_news_summary()`: 뉴스 요약 (Gemini API 연동)
- **상태**: ✅ 완료

#### 5. 브리핑 텍스트 생성
- **파일**: `backend/gemini_briefing.py`
- **기능**: 
  - `generate_briefing_text()`: Gemini API로 브리핑 텍스트 생성
  - `summarize_news()`: 뉴스 요약 생성
  - `generate_stock_analysis()`: 종목 분석 생성
- **상태**: ✅ 완료 (텍스트만)

---

### ❌ 미구현/부족한 부분

#### 1. 매일 아침 7시 자동 실행
- **현재 상태**: 스케줄러 없음
- **필요한 작업**:
  - Python 스케줄러 (APScheduler, schedule 등) 또는
  - Cron job (Linux/Mac) 또는
  - Windows Task Scheduler 또는
  - 클라우드 스케줄러 (AWS EventBridge, Google Cloud Scheduler 등)
- **권장 방안**: 
  - 개발 환경: APScheduler 사용
  - 프로덕션: 클라우드 스케줄러 또는 Cron

#### 2. 브리핑 이미지 생성
- **현재 상태**: 텍스트만 생성됨
- **필요한 작업**:
  - Gemini API의 이미지 생성 기능 활용
  - 또는 Pillow/PIL로 텍스트를 이미지로 변환
  - 브리핑 템플릿 이미지 생성
- **권장 방안**: 
  - Gemini API의 이미지 생성 기능 확인
  - 텍스트 + 차트를 포함한 이미지 생성

#### 3. 자동 발송 시스템
- **현재 상태**: 발송 기능 없음
- **필요한 작업**:
  - 이메일 발송: SMTP 또는 SendGrid, AWS SES 등
  - 슬랙 발송: Slack Webhook API
  - 발송 실패 처리 및 재시도 로직
- **권장 방안**: 
  - 이메일: SendGrid 또는 AWS SES
  - 슬랙: Slack Incoming Webhook

#### 4. 통합 워크플로우 스크립트
- **현재 상태**: 각 모듈이 분리되어 있음
- **필요한 작업**:
  - 전체 워크플로우를 실행하는 메인 스크립트 작성
  - 에러 처리 및 로깅
  - 각 단계별 상태 저장 (DB 또는 파일)
- **권장 방안**: 
  - `backend/daily_briefing_workflow.py` 생성
  - 단계별 실행 및 에러 핸들링

#### 5. 종목 분석 로직 강화
- **현재 상태**: 기본적인 종목 정보만 수집
- **필요한 작업**:
  - "왜 화제인지" 분석 로직 추가
  - 뉴스 내용 분석을 통한 화제 원인 파악
  - Gemini API를 활용한 심층 분석
- **권장 방안**: 
  - 뉴스 요약과 종목 데이터를 결합하여 분석
  - `generate_stock_analysis()` 함수 활용

---

## 다음 단계 개발 우선순위

### Phase 1: 핵심 워크플로우 통합 (최우선)
1. **통합 워크플로우 스크립트 작성**
   - 모든 단계를 연결하는 메인 스크립트
   - 에러 처리 및 로깅
   - 실행 시간 측정

2. **브리핑 이미지 생성 기능 추가**
   - Gemini API 이미지 생성 또는
   - 텍스트를 이미지로 변환하는 기능

### Phase 2: 자동화 및 발송
3. **자동 발송 시스템 구현**
   - 이메일 발송 기능
   - 슬랙 발송 기능
   - 발송 상태 추적

4. **스케줄러 설정**
   - 매일 아침 7시 자동 실행
   - 개발/프로덕션 환경별 설정

### Phase 3: 고도화
5. **종목 분석 로직 강화**
   - 화제 원인 분석
   - 뉴스 기반 인사이트 추출

6. **모니터링 및 알림**
   - 워크플로우 실행 상태 모니터링
   - 실패 시 알림

---

## 기술 스택 요약

### 현재 사용 중
- **종목 데이터**: yahooquery (Yahoo Finance)
- **뉴스 검색**: Exa API
- **AI 생성**: Google Gemini API
- **프론트엔드**: Next.js, React, TypeScript
- **백엔드**: Python

### 추가 필요
- **스케줄러**: APScheduler 또는 클라우드 스케줄러
- **이메일 발송**: SendGrid, AWS SES, 또는 SMTP
- **슬랙 발송**: Slack Webhook API
- **이미지 생성**: Gemini API 또는 Pillow/PIL
- **데이터 저장**: SQLite 또는 PostgreSQL (선택)

---

## 참고 문서

- `서비스기획서_당신이잠든사이.md`: 전체 서비스 기획
- `화제종목_선정_설계서.md`: 종목 선정 알고리즘 상세 설계
- `REST_API_명세서.md`: API 명세 (향후 구현 참고)
- `backend/README.md`: 백엔드 모듈 사용법

---

**작성일**: 2024-01-15
**목적**: 목표 워크플로우 학습 및 현재 상태 파악

