# 당신이 잠든 사이 - 버그 리포트

## 생성일시
2025-12-17

## 검토 범위
- 백엔드 Python 코드 (FastAPI, 워크플로우, API 라우터)
- 프론트엔드 TypeScript/Next.js 코드
- 환경 설정 파일

---

## 🔴 심각도: 높음 (Critical)

### 1. **gemini_briefing.py: Logger 정의 전 사용 오류**
- **파일**: `backend/gemini_briefing.py:17`
- **문제**: `logger`가 선언되기 전에 사용됨
```python
except ImportError:
    PIL_AVAILABLE = False
    logger.warning("Pillow가 설치되지 않았습니다...")  # 17번째 줄

# 로깅 설정
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)  # 20-21번째 줄에서 정의됨
```
- **영향**: 모듈 임포트 시 `NameError` 발생 가능
- **수정 방법**: logger 초기화를 모듈 최상단으로 이동

### 2. **briefings.py: stock_data 키 불일치**
- **파일**: `backend/routers/briefings.py:75`
- **문제**: `result.get('top_stock')`를 사용하지만 워크플로우는 `stock_data` 반환
```python
top_stock = result.get('top_stock', {})  # 존재하지 않는 키
# 실제 워크플로우는 result['stock_data']를 반환
```
- **영향**: 브리핑 생성 API가 빈 종목 정보 반환
- **수정 방법**: `result.get('stock_data', {})`로 변경

### 3. **.env 파일: API 키 미설정**
- **파일**: `backend/.env`
- **문제**: 모든 API 키가 placeholder 값으로 설정됨
```bash
GEMINI_API_KEY=your_gemini_api_key_here
EXA_API_KEY=your_exa_api_key_here
```
- **영향**: 실제 서비스 실행 불가능
- **수정 방법**: 실제 API 키 설정 필요 (사용자가 직접 설정해야 함)

---

## 🟡 심각도: 중간 (Medium)

### 4. **stocks.py: 뉴스 API 연동 미완료**
- **파일**: `backend/routers/stocks.py:281`
- **문제**: 뉴스 조회 기능이 TODO로 남아있음
```python
if include_news:
    # TODO: Exa API 또는 다른 뉴스 소스 연동
    logger.info(f"뉴스 조회는 아직 구현되지 않았습니다")
```
- **영향**: 종목 상세 조회 시 뉴스 데이터 없음
- **수정 방법**: Exa API 연동 구현

### 5. **프론트엔드-백엔드 연동 부재**
- **파일**: `pages/index.tsx`, `lib/mockData.ts`
- **문제**: 프론트엔드가 Mock 데이터만 사용 중
- **영향**: 실제 데이터 표시 안 됨
- **수정 방법**: API 호출 로직 구현

### 6. **스케줄러 통합 문제**
- **파일**: `backend/scheduler.py`, `backend/main.py`
- **문제**: 스케줄러가 FastAPI 서버와 별도로 실행되어야 함
- **영향**: 자동 브리핑 기능이 서버 시작 시 자동으로 시작되지 않음
- **수정 방법**: FastAPI lifespan에 백그라운드 스케줄러 통합

---

## 🟢 심각도: 낮음 (Low)

### 7. **briefings.py: 데이터베이스 미구현**
- **파일**: `backend/routers/briefings.py:174, 237`
- **문제**: 브리핑 목록/상세 조회가 TODO로 남아있음
- **영향**: 브리핑 히스토리 조회 불가
- **수정 방법**: 로컬 파일 시스템 또는 DB 연동

### 8. **send_briefing.py: 실제 발송 기능 미구현**
- **파일**: `backend/send_briefing.py`
- **문제**: 이메일/슬랙 발송이 시뮬레이션만 구현됨
- **영향**: 실제 브리핑 전송 불가
- **수정 방법**: SMTP 및 Slack Webhook 연동 구현

### 9. **package.json: 의존성 버전 고정 부재**
- **파일**: `package.json`
- **문제**: 일부 패키지가 캐럿(^) 버전 사용
- **영향**: 버전 불일치 가능성
- **수정 방법**: 특정 버전으로 고정 (선택사항)

---

## 📋 테스트 필요 항목

1. Yahoo Finance API 연결 테스트
2. Gemini API 키 유효성 검증
3. Exa API 키 유효성 검증
4. 브리핑 생성 워크플로우 End-to-End 테스트
5. 프론트엔드 빌드 테스트
6. 스케줄러 동작 테스트

---

## 🔧 즉시 수정 필요한 버그

1. gemini_briefing.py의 logger 오류 (Critical)
2. briefings.py의 stock_data 키 오류 (Critical)
3. stocks.py의 뉴스 연동 (Medium)

---

## 다음 단계

1. 위 버그들을 수정
2. 백엔드 API 테스트
3. 프론트엔드-백엔드 연동
4. End-to-End 테스트
5. 개발일지 작성
