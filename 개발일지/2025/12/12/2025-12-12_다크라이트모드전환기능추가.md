# 개발일지: 다크/라이트 모드 전환 기능 추가

## 작성시각
2025년 12월 12일

## 해결하고자 한 문제
사용자가 자신의 선호도나 환경에 따라 다크 모드와 라이트 모드를 선택할 수 있도록 하고 싶었습니다. 또한 시스템 설정을 자동으로 감지하여 초기 모드를 설정하고, 사용자의 선택을 저장하여 다음 방문 시에도 유지되도록 하고 싶었습니다.

## 해결된 것

### 1. Theme Context 생성
- `contexts/ThemeContext.tsx` 파일을 생성하여 테마 상태를 전역으로 관리합니다
- `ThemeProvider` 컴포넌트로 앱 전체를 감싸서 테마 상태를 제공합니다
- `useTheme` 훅을 통해 어디서든 테마를 읽고 변경할 수 있습니다

### 2. Tailwind CSS 다크 모드 설정
- `tailwind.config.js`에 `darkMode: 'class'` 설정을 추가했습니다
- 클래스 기반 다크 모드를 사용하여 `dark:` 접두사로 다크 모드 스타일을 적용할 수 있습니다
- 라이트 모드 색상 정의를 추가했습니다:
  - `light-bg`: #ffffff (흰색)
  - `light-card`: #f8fafc (slate-50)
  - `light-border`: #e2e8f0 (slate-200)

### 3. 헤더에 토글 스위치 추가
- `components/ThemeToggle.tsx` 컴포넌트를 생성했습니다
- 토글 스위치는 헤더 우측에 배치되었습니다
- 다크 모드일 때: 🌙 아이콘 표시
- 라이트 모드일 때: ☀️ 아이콘 표시
- 토글 스위치는 부드러운 애니메이션과 함께 작동합니다

### 4. 시스템 설정 감지
- `window.matchMedia('(prefers-color-scheme: dark)')`를 사용하여 시스템 설정을 감지합니다
- 로컬스토리지에 저장된 값이 없을 때만 시스템 설정을 따릅니다
- 시스템 설정이 변경되면 자동으로 업데이트됩니다 (로컬스토리지에 저장된 값이 없을 때만)

### 5. 로컬스토리지 저장
- 사용자가 선택한 테마를 `localStorage`에 저장합니다
- 키 이름: `theme-preference`
- 다음 방문 시 저장된 값을 우선적으로 사용합니다
- 시스템 설정보다 우선순위가 높습니다

### 6. 전환 애니메이션
- 모든 색상 전환에 `transition-colors duration-300` 클래스를 추가했습니다
- 토글 스위치의 이동 애니메이션: `transition-transform duration-300`
- 부드러운 300ms 애니메이션으로 모드 전환이 자연스럽게 이루어집니다

### 7. 모든 컴포넌트 다크/라이트 모드 지원
다음 컴포넌트들을 다크/라이트 모드에 맞게 수정했습니다:
- **Layout**: 헤더, 네비게이션
- **StockCard**: 종목 카드
- **TopStocksComparison**: TOP 3 비교 카드
- **BriefingCard**: 브리핑 카드
- **StockChart**: 차트 제목
- **pages/index.tsx**: 대시보드 페이지
- **pages/stocks/[symbol].tsx**: 종목 상세 페이지

### 8. 색상 매핑
- **텍스트 색상**:
  - 제목: `text-gray-900 dark:text-white`
  - 본문: `text-gray-600 dark:text-gray-400`
  - 보조 텍스트: `text-gray-600 dark:text-gray-400`
- **배경 색상**:
  - 메인 배경: `bg-light-bg dark:bg-dark-bg`
  - 카드 배경: `bg-light-card dark:bg-dark-card`
  - 테두리: `border-light-border dark:border-dark-border`

## 해결되지 않은 것

### 1. 차트 다크 모드
- recharts 차트의 색상이 다크/라이트 모드에 따라 자동으로 변경되지 않습니다
- 향후 차트 색상도 테마에 맞게 조정해야 합니다

### 2. 이미지 다크 모드
- 브리핑 이미지 등이 다크/라이트 모드에 따라 조정되지 않습니다
- 향후 이미지 필터나 오버레이를 추가할 수 있습니다

### 3. 애니메이션 최적화
- 현재는 모든 요소에 동일한 애니메이션을 적용했습니다
- 향후 성능 최적화를 위해 필요에 따라 애니메이션을 조정할 수 있습니다

### 4. 접근성 개선
- 키보드로 토글 스위치를 조작할 수 있지만, 스크린 리더 지원을 더 개선할 수 있습니다
- 고대비 모드 지원을 추가할 수 있습니다

## 향후 개발을 위한 컨텍스트

### 파일 구조
```
contexts/
└── ThemeContext.tsx        # 테마 Context (새로 생성)

components/
├── ThemeToggle.tsx        # 토글 스위치 컴포넌트 (새로 생성)
├── Layout.tsx             # 레이아웃 (수정)
├── StockCard.tsx          # 종목 카드 (수정)
├── TopStocksComparison.tsx # TOP 3 비교 (수정)
├── BriefingCard.tsx       # 브리핑 카드 (수정)
└── StockChart.tsx         # 차트 (수정)

pages/
├── _app.tsx               # 앱 루트 (ThemeProvider 추가)
├── index.tsx              # 대시보드 (수정)
└── stocks/
    └── [symbol].tsx       # 종목 상세 (수정)

styles/
└── globals.css            # 전역 스타일 (수정)

tailwind.config.js         # Tailwind 설정 (수정)
```

### Theme Context API
```typescript
interface ThemeContextType {
  theme: 'light' | 'dark';
  toggleTheme: () => void;
  setTheme: (theme: 'light' | 'dark') => void;
}

// 사용 예시
const { theme, toggleTheme } = useTheme();
```

### 테마 전환 로직
1. **초기화**:
   - 로컬스토리지 확인 → 있으면 사용
   - 없으면 시스템 설정 감지 → 다크 모드면 'dark', 아니면 'light'

2. **테마 변경**:
   - 사용자가 토글 클릭
   - `toggleTheme()` 호출
   - DOM에 `dark` 또는 `light` 클래스 추가/제거
   - 로컬스토리지에 저장

3. **시스템 설정 변경 감지**:
   - `prefers-color-scheme` 미디어 쿼리 리스너 등록
   - 로컬스토리지에 저장된 값이 없을 때만 업데이트

### Tailwind 다크 모드 사용법
```tsx
// 다크 모드에서만 적용
<div className="bg-white dark:bg-gray-900">
  <p className="text-gray-900 dark:text-white">텍스트</p>
</div>

// 커스텀 색상 사용
<div className="bg-light-bg dark:bg-dark-bg">
  <div className="border-light-border dark:border-dark-border">...</div>
</div>
```

### 애니메이션 설정
- **전환 시간**: 300ms (`duration-300`)
- **전환 속성**: 색상 (`transition-colors`)
- **토글 스위치**: 위치 이동 (`transition-transform`)

### 로컬스토리지 키
- **키 이름**: `theme-preference`
- **값**: `'light'` 또는 `'dark'`
- **우선순위**: 로컬스토리지 > 시스템 설정

### 다음 단계
1. **차트 다크 모드 지원** (최우선)
   - recharts 차트 색상을 테마에 맞게 조정
   - 그리드, 축, 툴팁 색상 변경

2. **이미지 다크 모드**
   - 이미지 필터 적용
   - 다크 모드에서 이미지 밝기 조정

3. **성능 최적화**
   - 애니메이션 최적화
   - 불필요한 리렌더링 방지

4. **접근성 개선**
   - 스크린 리더 지원 강화
   - 고대비 모드 지원
   - 키보드 네비게이션 개선

5. **추가 기능**
   - 테마별 커스텀 색상 설정
   - 자동 모드 전환 (시간대별)
   - 테마 미리보기

### 참고사항
- 다크 모드는 기본값으로 설정되어 있습니다 (기존 프로젝트와의 호환성)
- 시스템 설정 감지는 로컬스토리지에 저장된 값이 없을 때만 작동합니다
- 모든 색상 전환은 300ms 애니메이션으로 부드럽게 처리됩니다
- 토글 스위치는 접근성을 고려하여 `aria-label`을 포함합니다
- `_app.tsx`에서 `ThemeProvider`로 전체 앱을 감싸서 모든 페이지에서 테마를 사용할 수 있습니다

### 쉽게 설명하면
다크/라이트 모드 전환 기능은 마치 "조명 스위치"와 같습니다:
- **다크 모드**: 어두운 배경에 밝은 텍스트 (밤에 눈이 편안함)
- **라이트 모드**: 밝은 배경에 어두운 텍스트 (낮에 읽기 편함)
- **토글 스위치**: 헤더에 있는 버튼을 클릭하면 모드가 전환됩니다
- **자동 감지**: 처음 방문할 때 컴퓨터 설정을 자동으로 감지합니다
- **기억**: 선택한 모드를 기억해서 다음에 방문할 때도 그대로 유지됩니다

이제 사용자는 자신의 환경과 선호도에 맞게 다크 모드와 라이트 모드를 자유롭게 전환할 수 있습니다!




