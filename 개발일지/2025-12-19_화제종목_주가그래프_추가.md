# 개발일지 - 화제 종목 주가 그래프 및 TOP3 변동률 그래프 추가

## 작성시각
2025년 12월 19일

---

## 해결하고자 한 문제

### 1. 사용자 요구사항
- 대시보드의 **오늘의 화제 종목**에 최근 5일 주가 추이 그래프 표시
- **화제 종목 TOP 3**의 변동률을 비교하는 그래프 추가
- 데이터 시각화를 통한 직관적인 정보 전달

### 2. 기존 문제점
- 화제 종목 카드에 숫자 데이터만 표시되어 주가 추이를 한눈에 파악하기 어려움
- TOP 3 종목의 변동률을 비교하는 시각적 요소 부족
- 큰 카드(isLarge)에만 차트가 표시되어 일반 종목 카드에는 그래프가 없음

---

## 해결된 것

### ✅ 1. MiniStockChart 컴포넌트 생성
**파일**: `components/MiniStockChart.tsx`

#### 구현 내용
- 작은 크기의 간소화된 주가 차트 컴포넌트
- 높이를 조절할 수 있는 `height` prop 추가
- recharts의 `LineChart` 사용
- 상승/하락에 따른 차트 색상 변경 (녹색/빨간색)

#### 주요 기능
```typescript
interface MiniStockChartProps {
  data: StockPriceData[];
  isPositive: boolean;
  height?: number; // 기본값: 150px
}
```

#### 특징
- 동적 import로 클라이언트 사이드에서만 렌더링 (SSR 비활성화)
- 간소화된 축 레이블 (10px 폰트)
- 간결한 툴팁 (주가만 표시)
- 작은 점(dot) 크기로 깔끔한 표현

---

### ✅ 2. StockCard에 차트 추가
**파일**: `components/StockCard.tsx`

#### 변경 사항
**Before:**
```typescript
// 큰 카드일 때만 차트 데이터 가져오기
const chartData = isLarge ? getStockPriceHistory(stock.symbol, stock.price) : [];

// 큰 카드일 때만 차트 표시
{isLarge && chartData.length > 0 && (
  <StockChart data={chartData} isPositive={isPositive} />
)}
```

**After:**
```typescript
// 모든 카드에 차트 데이터 가져오기
const chartData = getStockPriceHistory(stock.symbol, stock.price);

// 차트 표시 (크기에 따라 다른 컴포넌트 사용)
{chartData.length > 0 && (
  <>
    {isLarge ? (
      <StockChart data={chartData} isPositive={isPositive} />
    ) : (
      <MiniStockChart data={chartData} isPositive={isPositive} height={120} />
    )}
  </>
)}
```

#### 결과
- **큰 카드**: 기존 `StockChart` 사용 (높이 300px, 거래량 포함)
- **일반 카드**: 새로운 `MiniStockChart` 사용 (높이 120px, 주가만)
- 모든 화제 종목 카드에 주가 추이 그래프 표시

---

### ✅ 3. TopStocksComparison에 변동률 비교 그래프 추가
**파일**: `components/TopStocksComparison.tsx`

#### 구현 내용
- recharts의 `BarChart` 추가
- TOP 3 종목의 변동률을 막대 그래프로 비교
- 상승은 녹색, 하락은 빨간색으로 표시

#### 차트 데이터 구조
```typescript
const chartData = stocks.map((stock, index) => ({
  name: stock.symbol,      // 종목 심볼 (AAPL, TSLA 등)
  변동률: stock.changePercent,  // 변동률 (%)
  fullName: stock.name,    // 전체 종목명
  rank: index + 1,         // 순위 (1, 2, 3)
}));
```

#### 차트 특징
1. **동적 색상**: 
   - 양수(상승): 녹색 (#10b981)
   - 음수(하락): 빨간색 (#ef4444)

2. **커스텀 툴팁**:
   - 순위 아이콘 (🥇, 🥈, 🥉)
   - 종목 전체명
   - 색상이 적용된 변동률

3. **Y축 포맷**:
   - 퍼센트(%) 단위로 표시
   - 예: +2.35%, -1.50%

4. **반응형 디자인**:
   - 높이 250px
   - 100% 너비
   - 모바일/데스크톱 모두 지원

#### 레이아웃 변경
```typescript
return (
  <div className="space-y-6">
    {/* 변동률 비교 그래프 */}
    <div className="card">
      <h3>📊 TOP 3 변동률 비교</h3>
      <ResponsiveContainer>
        <BarChart>...</BarChart>
      </ResponsiveContainer>
    </div>

    {/* 종목 카드들 */}
    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
      {/* 기존 카드들 */}
    </div>
  </div>
);
```

---

## 해결되지 않은 것

### ⚠️ 실시간 데이터 연동
**현재 상태**: Mock 데이터 사용
- `getStockPriceHistory()` 함수가 가상의 주가 데이터 생성
- 실제 API로부터 과거 주가 데이터를 받아오지 않음

**향후 개선 방안**:
1. yfinance 또는 Alpha Vantage API로 실제 과거 주가 데이터 수집
2. 백엔드에 새로운 엔드포인트 추가
   ```python
   @router.get("/stocks/{ticker}/history")
   def get_stock_history(ticker: str, days: int = 5):
       # 실제 API에서 과거 주가 데이터 가져오기
       ...
   ```
3. 프론트엔드에서 실시간 데이터 fetch

---

### ⚠️ 차트 성능 최적화
**현재 상태**: 모든 카드에 차트 렌더링
- 한 페이지에 여러 개의 차트가 동시 렌더링
- recharts의 동적 import로 초기 로딩은 최적화됨

**향후 개선 방안**:
1. Lazy loading: 스크롤 시 차트 렌더링
2. 차트 캐싱: 동일한 종목의 차트 데이터 재사용
3. 가상화(Virtualization): 보이는 차트만 렌더링

---

### ⚠️ 차트 인터랙션 강화
**현재 상태**: 기본 툴팁만 제공
- 호버 시 툴팁 표시
- 클릭 이벤트 없음

**향후 개선 방안**:
1. 차트 클릭 시 종목 상세 페이지로 이동
2. 범위 선택(Zoom) 기능
3. 기간 필터 (1주일, 1개월, 3개월 등)
4. 여러 종목 비교 오버레이

---

## 향후 개발을 위한 컨텍스트

### 📊 차트 컴포넌트 구조
```
components/
├── StockChart.tsx         # 큰 차트 (300px, 주가+거래량)
├── MiniStockChart.tsx     # 작은 차트 (120px, 주가만)
└── TopStocksComparison.tsx  # TOP3 비교 (변동률 막대 그래프)
```

### 🎨 차트 스타일 가이드
**색상 팔레트**:
- 상승(녹색): `#10b981`
- 하락(빨간색): `#ef4444`
- 배경: `#1e293b` (다크 모드)
- 테두리: `#334155`
- 텍스트: `#94a3b8`

**크기 가이드**:
- StockChart: 300px (종목 상세, 큰 카드)
- MiniStockChart: 120px (일반 카드)
- TopStocksComparison: 250px (비교 그래프)

### 🔧 기술 스택
- **차트 라이브러리**: recharts
- **동적 import**: next/dynamic (SSR 비활성화)
- **데이터 소스**: lib/mockData.ts의 `getStockPriceHistory()`

### 📝 Mock 데이터 생성 로직
```typescript
// lib/mockData.ts
export function getStockPriceHistory(symbol: string, currentPrice: number): StockPriceData[] {
  const history: StockPriceData[] = [];
  const today = new Date();
  
  for (let i = 4; i >= 0; i--) {
    const date = new Date(today);
    date.setDate(date.getDate() - i);
    
    // 현재가 기준으로 랜덤 변동 생성
    const variation = (Math.random() - 0.5) * 10;
    const price = currentPrice + variation;
    
    history.push({
      date: date.toISOString().split('T')[0],
      price: parseFloat(price.toFixed(2)),
      volume: Math.floor(Math.random() * 50000000) + 30000000,
    });
  }
  
  return history;
}
```

### 🚀 배포 시 체크리스트
1. [ ] recharts가 `dependencies`에 있는지 확인
2. [ ] `next/dynamic`으로 SSR 비활성화 확인
3. [ ] 다크/라이트 모드 모두에서 차트 가독성 확인
4. [ ] 모바일 반응형 레이아웃 테스트
5. [ ] 차트 로딩 상태 처리

### 🐛 알려진 이슈
**없음** - 현재 린터 오류 없음, 정상 작동

---

## 주요 변경 파일
1. **새로 생성**:
   - `components/MiniStockChart.tsx`

2. **수정**:
   - `components/StockCard.tsx`
   - `components/TopStocksComparison.tsx`

3. **변경 없음** (향후 수정 필요):
   - `lib/mockData.ts` (실제 API 연동 시 수정)
   - `pages/index.tsx` (레이아웃은 유지)

---

## 성과 및 결과

### 📈 시각화 개선
- **Before**: 숫자 데이터만 표시
- **After**: 그래프로 직관적인 추이 파악

### 🎯 사용자 경험 향상
- 한눈에 주가 추이 확인 가능
- TOP 3 종목의 변동률을 바로 비교
- 상승/하락을 색상으로 즉시 인식

### 🏆 코드 품질
- 재사용 가능한 컴포넌트 설계
- 린터 오류 0개
- 반응형 디자인 적용
- SSR 최적화 (동적 import)

---

## 다음 단계
1. 실제 주가 데이터 API 연동
2. 차트 인터랙션 강화 (클릭, 줌 등)
3. 기간 필터 추가
4. 차트 성능 모니터링 및 최적화
5. 사용자 피드백 수집 및 반영

