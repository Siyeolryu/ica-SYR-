# 개발일지: yfinance 라이브러리 통합

## 작성시각
2024년 1월 15일

## 해결하고자 한 문제
기존에 yahooquery를 사용했는데, yfinance 라이브러리도 사용해서 더 많은 주식 데이터를 가져올 수 있게 만들고 싶었어요. yfinance는 종목 상세 정보와 주가 히스토리를 더 쉽게 가져올 수 있어서 추가했어요.

## 해결된 것

### 1. yfinance 모듈 생성
- `backend/yfinance_stocks.py` 파일을 만들었어요
- yfinance 라이브러리를 사용해서 Yahoo Finance에서 데이터를 가져오는 함수들을 만들었어요

### 2. 주요 기능 4개 만들기
- **`get_trending_stocks_by_volume()`**: 거래량 상위 종목을 가져오는 함수
  - 주요 미국 주식들을 조회해서 거래량이 많은 순서로 정렬해요
- **`get_top_gainers()`**: 상승률 상위 종목을 가져오는 함수
  - 상승한 종목만 필터링해서 상승률이 높은 순서로 정렬해요
- **`get_stock_data()`**: 특정 종목의 상세 정보를 가져오는 함수
  - 종목 심볼을 입력하면 그 종목의 모든 정보를 가져와요
  - 최근 5일간의 주가 히스토리도 함께 가져와요
- **`get_top_trending_stock()`**: 오늘의 화제 종목 TOP 1을 가져오는 함수
  - 거래량과 상승률을 종합해서 점수를 계산해요
  - 점수가 가장 높은 종목을 TOP 1로 선정해요

### 3. 주가 히스토리 기능
- `get_stock_data()` 함수에서 최근 5일간의 주가 데이터를 가져와요
- 날짜별로 가격과 거래량을 보여줘요
- 차트를 그릴 때 사용할 수 있어요

### 4. requirements.txt 업데이트
- `yfinance>=0.2.28` 추가
- `pandas>=2.0.0` 추가 (yfinance가 pandas를 사용해서)

### 5. 사용 방법 문서 작성
- `backend/README_yfinance.md` 파일을 만들었어요
- 각 함수의 사용 방법과 예시를 설명했어요
- yfinance와 yahooquery의 차이점도 설명했어요

### 6. 테스트 코드 포함
- 파일을 직접 실행하면 테스트가 실행돼요
- 거래량 상위, 상승률 상위, TOP 1, 특정 종목 상세 정보를 모두 테스트해요

## 해결되지 않은 것

### 1. 동적 스크리너 결과
- 지금은 주요 종목 리스트를 하드코딩했어요
- 실제 Yahoo Finance 스크리너 결과를 동적으로 가져오는 기능이 없어요
- 나중에 Yahoo Finance API를 직접 호출해야 해요

### 2. 캐싱 기능
- 같은 종목을 여러 번 조회하면 매번 API를 호출해요
- 한 번 가져온 데이터를 저장해두는 기능이 없어요

### 3. 에러 재시도 로직
- API 호출이 실패하면 바로 포기해요
- 몇 번 재시도하는 기능이 없어요

### 4. 더 많은 종목 지원
- 지금은 주요 40개 종목만 조회해요
- 모든 미국 주식을 조회하는 기능이 없어요

### 5. 실시간 데이터
- 지금은 1일 데이터만 가져와요
- 실시간으로 업데이트되는 기능이 없어요

## 향후 개발을 위한 컨텍스트

### yfinance vs yahooquery 비교

**yfinance 장점:**
- 종목 상세 정보가 많아요 (재무 정보, 뉴스 등)
- 주가 히스토리를 쉽게 가져올 수 있어요
- 더 안정적인 API

**yfinance 단점:**
- 스크리너 기능이 없어서 직접 구현해야 해요
- 주요 종목 리스트를 직접 관리해야 해요

**yahooquery 장점:**
- 스크리너 기능이 내장되어 있어요 (most_actives, day_gainers 등)
- 더 간단한 API

**yahooquery 단점:**
- 종목 상세 정보가 제한적이에요
- 주가 히스토리 가져오기가 복잡해요

### 권장 사용법
- **스크리너 결과가 필요할 때**: `yahooquery` 사용 (기존 `get_trending_stocks.py`)
- **종목 상세 정보가 필요할 때**: `yfinance` 사용 (이 모듈)
- **주가 히스토리가 필요할 때**: `yfinance` 사용

### 파일 구조
```
backend/
├── get_trending_stocks.py    # yahooquery 사용 (스크리너)
├── yfinance_stocks.py         # yfinance 사용 (상세 정보) - 새로 만듦
├── requirements.txt           # 필요한 라이브러리 목록
├── README.md                  # yahooquery 사용법
└── README_yfinance.md         # yfinance 사용법 - 새로 만듦
```

### 사용 예시

**거래량 상위 종목:**
```python
from yfinance_stocks import get_trending_stocks_by_volume

stocks = get_trending_stocks_by_volume(limit=10)
for stock in stocks:
    print(f"{stock['symbol']}: ${stock['price']:.2f}")
```

**특정 종목 상세 정보:**
```python
from yfinance_stocks import get_stock_data

apple = get_stock_data('AAPL')
print(f"가격: ${apple['current_price']:.2f}")
print(f"변동률: {apple['change_percent']:+.2f}%")
```

**오늘의 화제 종목:**
```python
from yfinance_stocks import get_top_trending_stock

top = get_top_trending_stock()
print(f"TOP 1: {top['symbol']} - {top['change_percent']:+.2f}%")
```

### 다음 단계
1. **동적 스크리너 결과 가져오기** (최우선)
   - Yahoo Finance API를 직접 호출해서 스크리너 결과 가져오기
   - 하드코딩된 리스트 대신 동적으로 종목 리스트 생성

2. **캐싱 기능 추가**
   - Redis나 메모리 캐시 사용
   - 같은 데이터를 여러 번 요청하지 않도록

3. **에러 재시도 로직**
   - API 호출 실패 시 자동으로 재시도
   - 지수 백오프(exponential backoff) 사용

4. **더 많은 데이터 제공**
   - 뉴스 정보
   - 재무제표 데이터
   - 분석가 추천 정보

### 참고사항
- yfinance는 pandas를 사용해서 DataFrame을 반환해요
- API 호출 제한이 있어서 너무 많이 요청하면 차단될 수 있어요
- 미국 증시 운영 시간에만 실시간 데이터가 업데이트돼요
- 주말이나 공휴일에는 데이터가 없을 수 있어요

### 쉽게 설명하면
yfinance를 추가한 것은 마치 "도서관에 더 많은 책을 추가한 것"과 같아요.
- **기존 (yahooquery)**: 간단한 책 목록만 볼 수 있어요
- **새로운 (yfinance)**: 책의 상세 내용과 과거 기록까지 볼 수 있어요

이제 두 가지 도구를 모두 사용할 수 있어서, 상황에 맞게 선택해서 사용할 수 있어요!










